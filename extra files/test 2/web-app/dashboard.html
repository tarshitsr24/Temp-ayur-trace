<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - AyurTrace</title>
  <link rel="stylesheet" href="./style.css" />
    <style>
      .frame-wrap { height: 100vh; display: flex; flex-direction: column; }
      header.appbar { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--surface-2); border-bottom: 1px solid var(--border);
      }
      .role-badge { padding: 4px 10px; border-radius: 999px; background: var(--accent-10); color: #fff; font-size: 12px; }
      iframe.app-frame { flex: 1; width: 100%; border: 0; }
    </style>
  </head>
  <body>
    <div class="frame-wrap">
      <header class="appbar">
        <div class="brand">
          <strong>AyurTrace</strong>
        </div>
        <div class="right">
          <span id="roleBadge" class="role-badge"></span>
          <button id="logoutBtn" class="ghost">Logout</button>
        </div>
      </header>
      <iframe id="dashboardFrame" class="app-frame" src="" title="Stakeholder Dashboard"></iframe>
    </div>

  <script src="./js/auth.js"></script>
  <script src="./js/db.js"></script>
  <script src="./js/injector.js"></script>
    <script>
      (function init() {
        const session = Auth.requireAuth({ redirectTo: './login.html' });
        if (!session) return;

        const roleMap = {
          'Farmer': '../stakeholders/farmer.html',
          'Collector': '../stakeholders/collector.html',
          'Manufacturer': '../stakeholders/manufacturer_dash.html',
          'Auditor': '../stakeholders/auditor.html',
          // Placeholder mapping until a Distributor UI is added under stakeholders
          'Distributor': "../stakeholders/static_dashboard_wireframe (2).html"
        };

        const frame = document.getElementById('dashboardFrame');
        const badge = document.getElementById('roleBadge');
  frame.src = roleMap[session.role] || '../stakeholders/farmer.html';
        badge.textContent = session.role;

  document.getElementById('logoutBtn').addEventListener('click', () => {
          Auth.logout();
          window.location.href = './login.html';
        });

        frame.addEventListener('load', () => {
          try {
            Injector.inject(frame, session);
          } catch (e) {
            console.warn('Injection failed:', e);
          }
        });
      })();
    </script>
  </body>
  </html>
